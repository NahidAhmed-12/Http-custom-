<!DOCTYPE html>
<html>
<head>
  <title>PC Audio Sender</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    button { padding: 10px 15px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:disabled { background: #cccccc; }
    #status { margin-top: 20px; padding: 10px; border-radius: 4px; }
    .connected { background: #e6f4ea; color: #0d652d; }
    .disconnected { background: #fce8e6; color: #d93025; }
  </style>
</head>
<body>
  <h1>PC Audio Sender</h1>
  <p>এই পেজটি আপনার PC-তে ওপেন করুন</p>
  
  <button id="start">Start Streaming</button>
  <div id="status" class="disconnected">Not Connected</div>
  <div id="connectionCode" style="margin-top: 20px; display: none;">
    <p>ফোনে নিচের লিঙ্কটি ওপেন করুন:</p>
    <input type="text" id="phoneLink" readonly style="width: 100%; padding: 8px;">
  </div>

  <script>
    const startButton = document.getElementById('start');
    const statusDiv = document.getElementById('status');
    const connectionCodeDiv = document.getElementById('connectionCode');
    const phoneLinkInput = document.getElementById('phoneLink');
    
    let peerConnection;
    let localStream;
    let roomId = generateRoomId();

    // Generate a simple room ID
    function generateRoomId() {
      return Math.random().toString(36).substring(2, 8);
    }

    // Generate phone link
    const currentUrl = window.location.href.split('/').slice(0, 3).join('/');
    phoneLinkInput.value = `${currentUrl}/phone.html?room=${roomId}`;

    startButton.addEventListener('click', async () => {
      try {
        startButton.disabled = true;
        statusDiv.textContent = "Connecting...";
        
        // Capture audio from PC
        localStream = await navigator.mediaDevices.getUserMedia({ 
          audio: {
            echoCancellation: false,
            noiseSuppression: false,
            autoGainControl: false
          } 
        });
        
        // Create peer connection
        peerConnection = new RTCPeerConnection({
          iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });
        
        // Add audio track
        localStream.getAudioTracks().forEach(track => {
          peerConnection.addTrack(track, localStream);
        });
        
        // Listen for ICE candidates
        peerConnection.onicecandidate = (event) => {
          if (event.candidate) {
            // In a real app, you'd send this to the other peer via a signaling server
            console.log("ICE Candidate:", event.candidate);
          }
        };
        
        // Create offer
        const offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        
        // In a real app, you'd send the offer to the other peer here
        console.log("Offer:", offer);
        
        statusDiv.textContent = "Waiting for phone to connect...";
        connectionCodeDiv.style.display = 'block';
        
      } catch (err) {
        console.error('Error:', err);
        statusDiv.textContent = "Error: " + err.message;
        startButton.disabled = false;
      }
    });

    // This is a simplified version. In a real app, you'd need a signaling server
    // to exchange SDP offers/answers between PC and phone
  </script>
</body>
</html>
