<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Audio Receiver</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        #status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background-color: #dfd; }
        .disconnected { background-color: #fdd; }
        button { padding: 10px 15px; margin: 5px; background: #4285f4; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Audio Receiver (Phone)</h1>
    
    <div>
        <input type="text" id="sessionId" placeholder="Enter Session ID">
        <button id="connectBtn">Connect</button>
    </div>
    
    <div id="status" class="disconnected">Disconnected</div>
    
    <audio id="audioPlayer" controls></audio>

    <script>
        // ðŸ”¥ à¦à¦–à¦¾à¦¨à§‡ à¦†à¦ªà¦¨à¦¾à¦° Firebase à¦•à¦¨à¦«à¦¿à¦—à¦¾à¦°à§‡à¦¶à¦¨ à¦¦à¦¿à¦¨
        const firebaseConfig = {
            databaseURL: "https://audio-capture-769d1-default-rtdb.firebaseio.com/" // Replace with your URL
        };

        // Firebase à¦‡à¦¨à¦¿à¦¶à¦¿à§Ÿà¦¾à¦²à¦¾à¦‡à¦œ à¦•à¦°à§à¦¨
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM à¦à¦²à¦¿à¦®à§‡à¦¨à§à¦Ÿà¦¸
        const sessionIdInput = document.getElementById('sessionId');
        const connectBtn = document.getElementById('connectBtn');
        const statusDiv = document.getElementById('status');
        const audioPlayer = document.getElementById('audioPlayer');

        let sessionId = '';
        let audioContext;
        let audioQueue = [];
        let isPlaying = false;

        // à¦…à¦¡à¦¿à¦“ à¦ªà§à¦²à§‡ à¦•à¦°à¦¾à¦° à¦«à¦¾à¦‚à¦¶à¦¨
        function playAudioChunk(chunkData) {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioPlayer.crossOrigin = "anonymous";
            const source = audioContext.createMediaElementSource(audioPlayer);
                source.connect(audioContext.destination);
            }

            const audioBuffer = audioContext.createBuffer(1, chunkData.length, audioContext.sampleRate);
            audioBuffer.getChannelData(0).set(chunkData);
            
            const source = audioContext.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(audioContext.destination);
            source.start();
        }

        // Firebase à¦¥à§‡à¦•à§‡ à¦¡à¦¾à¦Ÿà¦¾ à¦¶à§‹à¦¨à¦¾à¦° à¦«à¦¾à¦‚à¦¶à¦¨
        function listenToAudioStream() {
            const audioRef = database.ref('sessions/' + sessionId + '/audio');
            
            audioRef.on('value', (snapshot) => {
                const audioData = snapshot.val();
                if (audioData && audioData.data) {
                    const float32Array = new Float32Array(audioData.data);
                    playAudioChunk(float32Array);
                }
            });
        }

        // à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿ à¦¬à¦¾à¦Ÿà¦¨ à¦‡à¦­à§‡à¦¨à§à¦Ÿ
        connectBtn.addEventListener('click', () => {
            sessionId = sessionIdInput.value.trim();
            if (sessionId) {
                statusDiv.textContent = "Connected to session: " + sessionId;
                statusDiv.className = "connected";
                listenToAudioStream();
            } else {
                alert("Please enter a session ID");
            }
        });

        // à¦…à¦¡à¦¿à¦“ à¦•à¦¨à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦‡à¦¨à¦¿à¦¶à¦¿à§Ÿà¦¾à¦²à¦¾à¦‡à¦œà§‡à¦¶à¦¨
        document.body.addEventListener('click', () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }, { once: true });
    </script>
</body>
</html>
